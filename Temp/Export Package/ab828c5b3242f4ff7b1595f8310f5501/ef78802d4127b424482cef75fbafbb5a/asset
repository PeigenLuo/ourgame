using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

public class BagPanelManage : MonoBehaviour
{
    public static BagPanelManage inst = null;
    private List<string> iMusicList = new List<string>();
    public List<AudioClip> iAudioList = new List<AudioClip>();
    public AudioSource iAudioSource;
    private Transform iCopyItem;

    private void Awake()
    {
        inst = this;
    }
    // Start is called before the first frame update
    void Start()
    {
        iCopyItem = transform.Find("Scroll View/Viewport/item");
        transform.Find("close").GetComponent<Button>().onClick.AddListener(doClickClose);
        doShowOrHidePanel(false);
    }
    public void doAddMusic(string musicname)
    {
        if (iMusicList.Contains(musicname))
            return;
        iMusicList.Add(musicname);
    }
    public void doShowPanel()
    {
        Transform content = transform.Find("Scroll View/Viewport/Content");
        for (int i= content.childCount-1; i>=0; i--)
        {
            Destroy(content.GetChild(i).gameObject);
        }
        for(int i = 0; i < iMusicList.Count; i++)
        {
            Transform item = Instantiate(iCopyItem);
            item.gameObject.name = iMusicList[i];
            item.SetParent(content);
            item.localScale = Vector3.one;
            item.localPosition = Vector3.zero;
            item.Find("Text").GetComponent<Text>().text = iMusicList[i];
            item.GetComponent<Button>().onClick.AddListener(()=>{
                doPlayMusic(item.gameObject.name);
            });
        }
        doShowOrHidePanel(true);
    }
    private void doPlayMusic(string musicname)
    {
        Debug.Log("musicname = " + musicname);
        string[] audio = musicname.Split('-');
        int index = (int.Parse(audio[0])-1) * 3 + int.Parse(audio[1]) - 1;
        iAudioSource.Stop();
        iAudioSource.clip = iAudioList[index];
        iAudioSource.Play();
    }
    private void doClickClose()
    {
        doShowOrHidePanel(false);
        iAudioSource.Stop();
    }
    public void doShowOrHidePanel(bool ck)
    {
        gameObject.SetActive(ck);
    }
    // Update is called once per frame
    void Update()
    {
        
    }
}
